# Use a Node.js Docker image for the CI environment
# Node.js is required to run npm commands
image: node:20

# Define the stages of the pipeline
stages:
  - test
  - build

# ------------------------
# Job: Test Backend
# ------------------------
test_backend:
  stage: test
  script:
    # Print message to indicate job start
    - echo "ðŸš€ Starting backend tests..."
    # Go to backend folder
    - cd backend
    # Install dependencies ignoring peer conflicts
    - npm install --legacy-peer-deps
    # Run tests (replace with your actual test command)
    - npm run test || echo "No tests defined"
    - echo "âœ… Backend ready!"
  only:
    - dev  # This job runs only on the 'dev' branch

# ------------------------
# Job: Build Frontend
# ------------------------
build_frontend:
  stage: build
  script:
    # Print message to indicate job start
    - echo "ðŸ“¦ Building frontend..."
    # Go to frontend folder
    - cd client
    # Install dependencies ignoring peer conflicts
    - npm install --legacy-peer-deps
    # Build the frontend for production
    - npm run build
    - echo "âœ… Frontend build complete!"
  only:
    - dev  # This job runs only on the 'dev' branch
